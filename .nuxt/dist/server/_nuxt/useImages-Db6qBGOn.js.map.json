{"file":"useImages-Db6qBGOn.js","mappings":"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","names":[],"sources":["../../../../composables/useImages.ts"],"sourcesContent":["/**\n * Composable useImages\n *\n * Centralise toutes les opérations CRUD sur les images\n * en utilisant le client Supabase injecté par Nuxt.\n */\n\nimport type { Image, NewImage } from '~/utils/supabase'\n\nexport const useImages = () => {\n  // Récupération du client Supabase depuis le plugin Nuxt\n  const { $supabase } = useNuxtApp()\n\n  /**\n   * RÉCUPÉRER toutes les images\n   * Triées par position (ordre d'affichage)\n   */\n  const fetchImages = async (): Promise<Image[]> => {\n    try {\n      const { data, error } = await $supabase\n        .from('images')\n        .select('*')\n        .order('position', { ascending: true })\n\n      if (error) {\n        console.error('Erreur fetchImages:', error)\n        return []\n      }\n\n      return data ?? []\n    } catch (error) {\n      console.error('Exception fetchImages:', error)\n      return []\n    }\n  }\n\n  /**\n   * CRÉER une nouvelle image\n   */\n  const createImage = async (newImage: NewImage): Promise<Image | null> => {\n    try {\n      const { data, error } = await $supabase\n        .from('images')\n        .insert([newImage])\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Erreur createImage:', error)\n        return null\n      }\n\n      return data\n    } catch (error) {\n      console.error('Exception createImage:', error)\n      return null\n    }\n  }\n\n  /**\n   * METTRE À JOUR une image existante\n   */\n  const updateImage = async (\n    id: string,\n    updates: Partial<NewImage>\n  ): Promise<Image | null> => {\n    try {\n      const { data, error } = await $supabase\n        .from('images')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Erreur updateImage:', error)\n        return null\n      }\n\n      return data\n    } catch (error) {\n      console.error('Exception updateImage:', error)\n      return null\n    }\n  }\n\n  /**\n   * SUPPRIMER une image\n   */\n  const deleteImage = async (id: string): Promise<boolean> => {\n    try {\n      const { error } = await $supabase\n        .from('images')\n        .delete()\n        .eq('id', id)\n\n      if (error) {\n        console.error('Erreur deleteImage:', error)\n        return false\n      }\n\n      return true\n    } catch (error) {\n      console.error('Exception deleteImage:', error)\n      return false\n    }\n  }\n\n  /**\n   * UPLOADER un fichier image vers Supabase Storage\n   */\n  const uploadImage = async (file: File): Promise<string | null> => {\n    try {\n      const timestamp = Date.now()\n      const sanitizedName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_')\n      const fileName = `${timestamp}-${sanitizedName}`\n\n      const { error: uploadError } = await $supabase.storage\n        .from('gallery-images')\n        .upload(fileName, file, {\n          cacheControl: '3600',\n          upsert: false\n        })\n\n      if (uploadError) {\n        console.error('Erreur uploadImage:', uploadError)\n        return null\n      }\n\n      const { data } = $supabase.storage\n        .from('gallery-images')\n        .getPublicUrl(fileName)\n\n      return data.publicUrl\n    } catch (error) {\n      console.error('Exception uploadImage:', error)\n      return null\n    }\n  }\n\n  /**\n   * SUPPRIMER un fichier du storage à partir de son URL publique\n   */\n  const deleteImageFromStorage = async (imageUrl: string): Promise<boolean> => {\n    try {\n      const fileName = imageUrl.split('/').pop()\n      if (!fileName) return false\n\n      const { error } = await $supabase.storage\n        .from('gallery-images')\n        .remove([fileName])\n\n      if (error) {\n        console.error('Erreur deleteImageFromStorage:', error)\n        return false\n      }\n\n      return true\n    } catch (error) {\n      console.error('Exception deleteImageFromStorage:', error)\n      return false\n    }\n  }\n\n  // API publique du composable\n  return {\n    fetchImages,\n    createImage,\n    updateImage,\n    deleteImage,\n    uploadImage,\n    deleteImageFromStorage\n  }\n}\n"],"version":3}