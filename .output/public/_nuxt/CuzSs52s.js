import{_ as B}from"./ChPo2WJa.js";import{e as T,r,f as G,c as n,o as l,a as t,b as $,w as q,d as z,g as L,h as k,i as p,v as m,t as d,F as R,j as H}from"./BAfX8Akq.js";import{u as J}from"./ChYJGf6c.js";import{u as O,_ as W}from"./BNqxgLyG.js";const K={class:"admin-page"},Q={class:"admin-header"},X={class:"header-content"},Y={class:"admin-content"},Z={class:"add-section card"},ee={class:"form-group"},te={class:"form-group"},se={class:"form-group"},ie={class:"form-group"},oe=["disabled"],ne={key:0,class:"success-message"},le={key:1,class:"error-message"},ae={class:"list-section card"},re={key:0,class:"loading"},ue={key:1,class:"images-list"},de={class:"image-preview"},ce=["src","alt"],pe={class:"image-info"},me={key:0,class:"edit-mode"},ve={class:"edit-actions"},fe=["onClick"],ge={key:1,class:"view-mode"},_e={class:"description"},he={class:"metadata"},be={class:"actions"},ye=["onClick"],we=["onClick"],xe={key:2,class:"empty"},ke=T({__name:"admin",setup(Ie){const{fetchImages:I,createImage:E,updateImage:C,deleteImage:A,uploadImage:V,deleteImageFromStorage:D}=J(),c=r([]),b=r(!0),g=r(!1),v=r(""),f=r(""),_=r(null),o=r({title:"",description:"",position:0}),y=r(null),a=r({title:"",description:"",position:0}),h=async()=>{b.value=!0;try{c.value=await I()}catch(s){console.error("Erreur de chargement:",s)}finally{b.value=!1}},F=s=>{const e=s.target;e.files&&e.files[0]&&(_.value=e.files[0])},U=async()=>{if(v.value="",f.value="",!_.value){f.value="Veuillez sÃ©lectionner un fichier";return}g.value=!0;try{const s=await V(_.value);if(!s)throw new Error("Erreur lors de l'upload du fichier");if(!await E({title:o.value.title,description:o.value.description,image_url:s,position:o.value.position}))throw new Error("Erreur lors de l'insertion en base");v.value="Image ajoutÃ©e avec succÃ¨s !",await h(),M(),setTimeout(()=>{v.value=""},3e3)}catch(s){console.error("Erreur handleAddImage:",s),f.value="Une erreur est survenue lors de l'ajout"}finally{g.value=!1}},M=()=>{o.value={title:"",description:"",position:c.value.length},_.value=null;const s=document.getElementById("file-input");s&&(s.value="")},S=s=>{y.value=s.id,a.value={title:s.title,description:s.description,position:s.position}},x=()=>{y.value=null,a.value={title:"",description:"",position:0}},j=async s=>{try{await C(s,a.value),await h(),x()}catch(e){console.error("Erreur handleSaveEdit:",e),alert("Erreur lors de la modification")}},N=async s=>{if(confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer "${s.title}" ?`))try{await A(s.id),s.image_url.includes("supabase")&&await D(s.image_url),await h()}catch(w){console.error("Erreur handleDelete:",w),alert("Erreur lors de la suppression")}},P=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});return G(()=>{h(),o.value.position=c.value.length}),O({title:"Administration - Galerie Interactive",meta:[{name:"robots",content:"noindex, nofollow"}]}),(s,e)=>{const w=B;return l(),n("div",K,[t("header",Q,[t("div",X,[e[7]||(e[7]=t("h1",null,"ğŸ¨ Interface d'Administration",-1)),$(w,{to:"/",class:"back-link"},{default:q(()=>[...e[6]||(e[6]=[z(" â† Retour Ã  la galerie ",-1)])]),_:1})])]),t("main",Y,[t("section",Z,[e[14]||(e[14]=t("h2",null,"â• Ajouter une nouvelle image",-1)),t("form",{onSubmit:L(U,["prevent"]),class:"add-form"},[t("div",ee,[e[8]||(e[8]=t("label",{for:"file-input"},"Fichier image *",-1)),t("input",{id:"file-input",type:"file",accept:"image/*",onChange:F,required:"",class:"file-input"},null,32),e[9]||(e[9]=t("p",{class:"help-text"},"JPG, PNG, GIF ou WebP - Max 5 MB",-1))]),t("div",te,[e[10]||(e[10]=t("label",{for:"title-input"},"Titre *",-1)),p(t("input",{id:"title-input","onUpdate:modelValue":e[0]||(e[0]=i=>o.value.title=i),type:"text",placeholder:"Ex: Architecture moderne",required:"",class:"text-input"},null,512),[[m,o.value.title]])]),t("div",se,[e[11]||(e[11]=t("label",{for:"description-input"},"Description",-1)),p(t("textarea",{id:"description-input","onUpdate:modelValue":e[1]||(e[1]=i=>o.value.description=i),placeholder:"DÃ©crivez briÃ¨vement l'image...",rows:"3",class:"text-input"},null,512),[[m,o.value.description]])]),t("div",ie,[e[12]||(e[12]=t("label",{for:"position-input"},"Position d'affichage *",-1)),p(t("input",{id:"position-input","onUpdate:modelValue":e[2]||(e[2]=i=>o.value.position=i),type:"number",min:"0",required:"",class:"text-input"},null,512),[[m,o.value.position,void 0,{number:!0}]]),e[13]||(e[13]=t("p",{class:"help-text"}," Ordre d'affichage (0 = premier, 1 = deuxiÃ¨me, etc.) ",-1))]),t("button",{type:"submit",disabled:g.value,class:"submit-button"},d(g.value?"â³ Upload en cours...":"âœ“ Ajouter l'image"),9,oe),v.value?(l(),n("p",ne," âœ“ "+d(v.value),1)):k("",!0),f.value?(l(),n("p",le," âŒ "+d(f.value),1)):k("",!0)],32)]),t("section",ae,[t("h2",null,"ğŸ“‹ Images existantes ("+d(c.value.length)+")",1),b.value?(l(),n("div",re,[...e[15]||(e[15]=[t("div",{class:"loader"},null,-1),t("p",null,"Chargement...",-1)])])):c.value.length>0?(l(),n("div",ue,[(l(!0),n(R,null,H(c.value,i=>(l(),n("div",{key:i.id,class:"image-card"},[t("div",de,[t("img",{src:i.image_url,alt:i.title},null,8,ce)]),t("div",pe,[y.value===i.id?(l(),n("div",me,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=u=>a.value.title=u),type:"text",placeholder:"Titre",class:"edit-input"},null,512),[[m,a.value.title]]),p(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=u=>a.value.description=u),placeholder:"Description",rows:"2",class:"edit-input"},null,512),[[m,a.value.description]]),p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=u=>a.value.position=u),type:"number",placeholder:"Position",class:"edit-input small"},null,512),[[m,a.value.position,void 0,{number:!0}]]),t("div",ve,[t("button",{onClick:u=>j(i.id),class:"save-button"}," âœ“ Enregistrer ",8,fe),t("button",{onClick:x,class:"cancel-button"}," âœ• Annuler ")])])):(l(),n("div",ge,[t("h3",null,d(i.title),1),t("p",_e,d(i.description||"Aucune description"),1),t("p",he," Position: "+d(i.position)+" â€¢ CrÃ©Ã©e le "+d(P(i.created_at)),1),t("div",be,[t("button",{onClick:u=>S(i),class:"edit-button"}," âœï¸ Modifier ",8,ye),t("button",{onClick:u=>N(i),class:"delete-button"}," ğŸ—‘ï¸ Supprimer ",8,we)])]))])]))),128))])):(l(),n("div",xe,[...e[16]||(e[16]=[t("p",null,"Aucune image pour le moment. Ajoutez-en une ci-dessus !",-1)])]))])])])}}}),De=W(ke,[["__scopeId","data-v-60fc0ca8"]]);export{De as default};
