{"file":"admin-CHsO1N1f.js","mappings":";;;;;;;;;;;;;;;;;;;;AAkOI,cAAA;AAGJ,UAAM,SAAS,IAAa,EAAE;AAC9B,UAAM,UAAU,IAAI,IAAI;AACxB,UAAM,YAAY,IAAI,KAAK;AAC3B,UAAM,iBAAiB,IAAI,EAAE;AAC7B,UAAM,eAAe,IAAI,EAAE;AAGN,QAAiB,IAAI;AAC1C,UAAM,WAAW,IAAI;AAAA,MACnB,OAAO;AAAA,MACP,aAAa;AAAA,MACb,UAAU;AAAA,IAAA,CACX;AAGD,UAAM,YAAY,IAAmB,IAAI;AACzC,UAAM,WAAW,IAAI;AAAA,MACnB,OAAO;AAAA,MACP,aAAa;AAAA,MACb,UAAU;AAAA,IAAA,CACX;AAkKD,UAAM,aAAa,CAAC,eAAuB;AACzC,YAAM,OAAO,IAAI,KAAK,UAAU;AAChC,aAAO,KAAK,mBAAmB,SAAS;AAAA,QACtC,KAAK;AAAA,QACL,OAAO;AAAA,QACP,MAAM;AAAA,MAAA,CACP;AAAA,IACH;AAcA,YAAQ;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,QACJ;AAAA,UACE,MAAM;AAAA,UACN,SAAS;AAAA,QAAA;AAAA,MACX;AAAA,IACF,CACD;;;AA3aM,YAAA,OAAAA,eAAAC,WAAA,EAAA,OAAM,gBAAY,MAAA,CAAA,CAAA,sKAAA;;QAKP,IAAG;AAAA,QAAI,OAAM;AAAA,MAAA;yBAAvB,CAEW,GAAAC,QAAAC,UAAA,aAAA;;;;;8BAFwB,yBAEnC;AAAA,YAAA;AAAA;;;;qmBA6BeC,cAAA,SAAA,SAAA,MAAS,KAAK,kVAadC,eAAA,SAAA,MAAS,WAAW,qKAYbD,cAAA,SAAA,SAAA,MAAS,QAAQ,0NAcxB,UAAA,KAAS,IAAA,cAAA,2DAGjB,UAAA,QAAS,yBAAA,mBAAA;UAIL,eAAA,OAAc;8EAChB,eAAA,KAAc,CAAA,MAAA;AAAA;;;UAIZ,aAAA,OAAY;4EACd,aAAA,KAAY,CAAA,MAAA;AAAA;;;AAOQ,YAAA,iHAAAC,eAAA,OAAA,MAAO,MAAM,CAAA,QAAA;UAG/B,QAAA,OAAO;;MAMF,WAAA,OAAA,MAAO,SAAM,GAAA;;AAETC,sBAAA,OAAA,QAAT,UAAK;wHAMJ,OAAK,MAAM,SAAS,kBAAG,OAAK,MAAM,KAAK;cAMlC,UAAA,UAAc,MAAM,IAAE;kEAEpBF,cAAA,SAAA,SAAA,MAAS,KAAK,wJAMdC,eAAA,SAAA,MAAS,WAAW,qBAMbD,cAAA,SAAA,SAAA,MAAS,QAAQ;;gFAwB5BC,eAAA,MAAM,KAAK,gDACQA,eAAA,MAAM,eAAW,oBAAA,uDAE5BA,eAAA,MAAM,QAAQ,+BACf,WAAW,MAAM,UAAU,CAAA;;;;;;;;;;;;;;;;;;;","names":["_ssrRenderAttrs","_mergeProps","_push","_parent","_ssrRenderAttr","_ssrInterpolate","_ssrRenderList"],"sources":["../../../../pages/admin.vue"],"sourcesContent":["<!--\n  PAGE D'ADMINISTRATION - CRUD COMPLET\n\n  Interface de gestion des images de la galerie.\n\n  Fonctionnalit√©s :\n  - Ajouter une nouvelle image (upload + m√©tadonn√©es)\n  - Modifier titre, description, position\n  - Supprimer une image\n  - R√©organiser l'ordre d'affichage\n-->\n\n<template>\n  <div class=\"admin-page\">\n    <!-- En-t√™te -->\n    <header class=\"admin-header\">\n      <div class=\"header-content\">\n        <h1>üé® Interface d'Administration</h1>\n        <NuxtLink to=\"/\" class=\"back-link\">\n          ‚Üê Retour √† la galerie\n        </NuxtLink>\n      </div>\n    </header>\n\n    <main class=\"admin-content\">\n      <!-- Section d'ajout d'une nouvelle image -->\n      <section class=\"add-section card\">\n        <h2>‚ûï Ajouter une nouvelle image</h2>\n\n        <form @submit.prevent=\"handleAddImage\" class=\"add-form\">\n          <!-- Upload de fichier -->\n          <div class=\"form-group\">\n            <label for=\"file-input\">Fichier image *</label>\n            <input\n              id=\"file-input\"\n              type=\"file\"\n              accept=\"image/*\"\n              @change=\"handleFileChange\"\n              required\n              class=\"file-input\"\n            />\n            <p class=\"help-text\">JPG, PNG, GIF ou WebP - Max 5 MB</p>\n          </div>\n\n          <!-- Titre -->\n          <div class=\"form-group\">\n            <label for=\"title-input\">Titre *</label>\n            <input\n              id=\"title-input\"\n              v-model=\"newImage.title\"\n              type=\"text\"\n              placeholder=\"Ex: Architecture moderne\"\n              required\n              class=\"text-input\"\n            />\n          </div>\n\n          <!-- Description -->\n          <div class=\"form-group\">\n            <label for=\"description-input\">Description</label>\n            <textarea\n              id=\"description-input\"\n              v-model=\"newImage.description\"\n              placeholder=\"D√©crivez bri√®vement l'image...\"\n              rows=\"3\"\n              class=\"text-input\"\n            ></textarea>\n          </div>\n\n          <!-- Position -->\n          <div class=\"form-group\">\n            <label for=\"position-input\">Position d'affichage *</label>\n            <input\n              id=\"position-input\"\n              v-model.number=\"newImage.position\"\n              type=\"number\"\n              min=\"0\"\n              required\n              class=\"text-input\"\n            />\n            <p class=\"help-text\">\n              Ordre d'affichage (0 = premier, 1 = deuxi√®me, etc.)\n            </p>\n          </div>\n\n          <!-- Bouton d'envoi -->\n          <button\n            type=\"submit\"\n            :disabled=\"uploading\"\n            class=\"submit-button\"\n          >\n            {{ uploading ? '‚è≥ Upload en cours...' : '‚úì Ajouter l\\'image' }}\n          </button>\n\n          <!-- Message de succ√®s -->\n          <p v-if=\"successMessage\" class=\"success-message\">\n            ‚úì {{ successMessage }}\n          </p>\n\n          <!-- Message d'erreur -->\n          <p v-if=\"errorMessage\" class=\"error-message\">\n            ‚ùå {{ errorMessage }}\n          </p>\n        </form>\n      </section>\n\n      <!-- Section de liste des images existantes -->\n      <section class=\"list-section card\">\n        <h2>üìã Images existantes ({{ images.length }})</h2>\n\n        <!-- √âtat de chargement -->\n        <div v-if=\"loading\" class=\"loading\">\n          <div class=\"loader\"></div>\n          <p>Chargement...</p>\n        </div>\n\n        <!-- Liste des images -->\n        <div v-else-if=\"images.length > 0\" class=\"images-list\">\n          <div\n            v-for=\"image in images\"\n            :key=\"image.id\"\n            class=\"image-card\"\n          >\n            <!-- Aper√ßu de l'image -->\n            <div class=\"image-preview\">\n              <img :src=\"image.image_url\" :alt=\"image.title\" />\n            </div>\n\n            <!-- Informations et actions -->\n            <div class=\"image-info\">\n              <!-- Mode √©dition -->\n              <div v-if=\"editingId === image.id\" class=\"edit-mode\">\n                <input\n                  v-model=\"editForm.title\"\n                  type=\"text\"\n                  placeholder=\"Titre\"\n                  class=\"edit-input\"\n                />\n                <textarea\n                  v-model=\"editForm.description\"\n                  placeholder=\"Description\"\n                  rows=\"2\"\n                  class=\"edit-input\"\n                ></textarea>\n                <input\n                  v-model.number=\"editForm.position\"\n                  type=\"number\"\n                  placeholder=\"Position\"\n                  class=\"edit-input small\"\n                />\n\n                <div class=\"edit-actions\">\n                  <button\n                    @click=\"handleSaveEdit(image.id)\"\n                    class=\"save-button\"\n                  >\n                    ‚úì Enregistrer\n                  </button>\n                  <button\n                    @click=\"cancelEdit\"\n                    class=\"cancel-button\"\n                  >\n                    ‚úï Annuler\n                  </button>\n                </div>\n              </div>\n\n              <!-- Mode affichage -->\n              <div v-else class=\"view-mode\">\n                <h3>{{ image.title }}</h3>\n                <p class=\"description\">{{ image.description || 'Aucune description' }}</p>\n                <p class=\"metadata\">\n                  Position: {{ image.position }} ‚Ä¢\n                  Cr√©√©e le {{ formatDate(image.created_at) }}\n                </p>\n\n                <div class=\"actions\">\n                  <button\n                    @click=\"startEdit(image)\"\n                    class=\"edit-button\"\n                  >\n                    ‚úèÔ∏è Modifier\n                  </button>\n                  <button\n                    @click=\"handleDelete(image)\"\n                    class=\"delete-button\"\n                  >\n                    üóëÔ∏è Supprimer\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- √âtat vide -->\n        <div v-else class=\"empty\">\n          <p>Aucune image pour le moment. Ajoutez-en une ci-dessus !</p>\n        </div>\n      </section>\n    </main>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n/**\n * LOGIQUE DE L'INTERFACE D'ADMINISTRATION\n *\n * Gestion compl√®te du CRUD :\n * - Create : upload + insertion en base\n * - Read : liste des images\n * - Update : modification des m√©tadonn√©es\n * - Delete : suppression base + storage\n */\n\nimport { ref, onMounted } from 'vue'\nimport type { Image } from '~/utils/supabase'\n\n// R√©cup√©rer les fonctions CRUD\nconst {\n  fetchImages,\n  createImage,\n  updateImage,\n  deleteImage,\n  uploadImage,\n  deleteImageFromStorage\n} = useImages()\n\n// Variables r√©actives\nconst images = ref<Image[]>([])\nconst loading = ref(true)\nconst uploading = ref(false)\nconst successMessage = ref('')\nconst errorMessage = ref('')\n\n// Formulaire d'ajout\nconst selectedFile = ref<File | null>(null)\nconst newImage = ref({\n  title: '',\n  description: '',\n  position: 0\n})\n\n// Formulaire d'√©dition\nconst editingId = ref<string | null>(null)\nconst editForm = ref({\n  title: '',\n  description: '',\n  position: 0\n})\n\n/**\n * Charger les images au d√©marrage\n */\nconst loadImages = async () => {\n  loading.value = true\n  try {\n    images.value = await fetchImages()\n  } catch (error) {\n    console.error('Erreur de chargement:', error)\n  } finally {\n    loading.value = false\n  }\n}\n\n/**\n * G√©rer la s√©lection d'un fichier\n */\nconst handleFileChange = (event: Event) => {\n  const target = event.target as HTMLInputElement\n  if (target.files && target.files[0]) {\n    selectedFile.value = target.files[0]\n  }\n}\n\n/**\n * Ajouter une nouvelle image\n */\nconst handleAddImage = async () => {\n  // R√©initialiser les messages\n  successMessage.value = ''\n  errorMessage.value = ''\n\n  // V√©rifier qu'un fichier est s√©lectionn√©\n  if (!selectedFile.value) {\n    errorMessage.value = 'Veuillez s√©lectionner un fichier'\n    return\n  }\n\n  uploading.value = true\n\n  try {\n    // 1. Upload du fichier vers Supabase Storage\n    const imageUrl = await uploadImage(selectedFile.value)\n\n    if (!imageUrl) {\n      throw new Error('Erreur lors de l\\'upload du fichier')\n    }\n\n    // 2. Insertion en base de donn√©es\n    const result = await createImage({\n      title: newImage.value.title,\n      description: newImage.value.description,\n      image_url: imageUrl,\n      position: newImage.value.position\n    })\n\n    if (!result) {\n      throw new Error('Erreur lors de l\\'insertion en base')\n    }\n\n    // 3. Succ√®s : rafra√Æchir la liste et r√©initialiser le formulaire\n    successMessage.value = 'Image ajout√©e avec succ√®s !'\n    await loadImages()\n    resetAddForm()\n\n    // Masquer le message apr√®s 3 secondes\n    setTimeout(() => {\n      successMessage.value = ''\n    }, 3000)\n  } catch (error) {\n    console.error('Erreur handleAddImage:', error)\n    errorMessage.value = 'Une erreur est survenue lors de l\\'ajout'\n  } finally {\n    uploading.value = false\n  }\n}\n\n/**\n * R√©initialiser le formulaire d'ajout\n */\nconst resetAddForm = () => {\n  newImage.value = {\n    title: '',\n    description: '',\n    position: images.value.length\n  }\n  selectedFile.value = null\n  // R√©initialiser l'input file\n  const fileInput = document.getElementById('file-input') as HTMLInputElement\n  if (fileInput) fileInput.value = ''\n}\n\n/**\n * D√©marrer l'√©dition d'une image\n */\nconst startEdit = (image: Image) => {\n  editingId.value = image.id\n  editForm.value = {\n    title: image.title,\n    description: image.description,\n    position: image.position\n  }\n}\n\n/**\n * Annuler l'√©dition\n */\nconst cancelEdit = () => {\n  editingId.value = null\n  editForm.value = {\n    title: '',\n    description: '',\n    position: 0\n  }\n}\n\n/**\n * Sauvegarder les modifications\n */\nconst handleSaveEdit = async (id: string) => {\n  try {\n    await updateImage(id, editForm.value)\n    await loadImages()\n    cancelEdit()\n  } catch (error) {\n    console.error('Erreur handleSaveEdit:', error)\n    alert('Erreur lors de la modification')\n  }\n}\n\n/**\n * Supprimer une image\n */\nconst handleDelete = async (image: Image) => {\n  // Confirmation\n  const confirmed = confirm(\n    `√ätes-vous s√ªr de vouloir supprimer \"${image.title}\" ?`\n  )\n  if (!confirmed) return\n\n  try {\n    // 1. Supprimer de la base de donn√©es\n    await deleteImage(image.id)\n\n    // 2. Supprimer du storage (si l'image vient de Supabase)\n    if (image.image_url.includes('supabase')) {\n      await deleteImageFromStorage(image.image_url)\n    }\n\n    // 3. Rafra√Æchir la liste\n    await loadImages()\n  } catch (error) {\n    console.error('Erreur handleDelete:', error)\n    alert('Erreur lors de la suppression')\n  }\n}\n\n/**\n * Formater une date\n */\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString)\n  return date.toLocaleDateString('fr-FR', {\n    day: 'numeric',\n    month: 'long',\n    year: 'numeric'\n  })\n}\n\n/**\n * Charger les images au montage\n */\nonMounted(() => {\n  loadImages()\n  // Initialiser la position avec le nombre d'images existantes\n  newImage.value.position = images.value.length\n})\n\n/**\n * Configuration SEO\n */\nuseHead({\n  title: 'Administration - Galerie Interactive',\n  meta: [\n    {\n      name: 'robots',\n      content: 'noindex, nofollow'\n    }\n  ]\n})\n</script>\n\n<style scoped>\n/**\n * STYLES DE L'INTERFACE D'ADMINISTRATION\n */\n\n.admin-page {\n  min-height: 100vh;\n  background: #f8fafc;\n}\n\n/**\n * EN-T√äTE\n */\n.admin-header {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  padding: 32px 20px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.header-content {\n  max-width: 1200px;\n  margin: 0 auto;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 16px;\n}\n\n.admin-header h1 {\n  margin: 0;\n  font-size: 1.75rem;\n  font-weight: 700;\n}\n\n.back-link {\n  color: white;\n  text-decoration: none;\n  padding: 8px 16px;\n  background: rgba(255, 255, 255, 0.2);\n  border-radius: 6px;\n  transition: background 0.2s ease;\n}\n\n.back-link:hover {\n  background: rgba(255, 255, 255, 0.3);\n}\n\n/**\n * CONTENU PRINCIPAL\n */\n.admin-content {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 40px 20px;\n}\n\n.card {\n  background: white;\n  border-radius: 12px;\n  padding: 32px;\n  margin-bottom: 32px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n\n.card h2 {\n  margin: 0 0 24px 0;\n  font-size: 1.5rem;\n  color: #1a202c;\n}\n\n/**\n * FORMULAIRE D'AJOUT\n */\n.add-form {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.form-group {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.form-group label {\n  font-weight: 600;\n  color: #2d3748;\n  font-size: 0.95rem;\n}\n\n.text-input,\n.file-input {\n  padding: 12px 16px;\n  border: 2px solid #e2e8f0;\n  border-radius: 8px;\n  font-size: 1rem;\n  transition: border-color 0.2s ease;\n}\n\n.text-input:focus,\n.file-input:focus {\n  outline: none;\n  border-color: #667eea;\n}\n\n.help-text {\n  font-size: 0.85rem;\n  color: #718096;\n  margin: 0;\n}\n\n.submit-button {\n  padding: 14px 24px;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n}\n\n.submit-button:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n}\n\n.submit-button:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.success-message {\n  padding: 12px 16px;\n  background: #d4edda;\n  color: #155724;\n  border-radius: 8px;\n  margin: 0;\n}\n\n.error-message {\n  padding: 12px 16px;\n  background: #f8d7da;\n  color: #721c24;\n  border-radius: 8px;\n  margin: 0;\n}\n\n/**\n * LISTE DES IMAGES\n */\n.loading {\n  text-align: center;\n  padding: 40px 20px;\n  color: #718096;\n}\n\n.loader {\n  width: 40px;\n  height: 40px;\n  border: 3px solid #e2e8f0;\n  border-top-color: #667eea;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin: 0 auto 16px;\n}\n\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.images-list {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.image-card {\n  display: flex;\n  gap: 20px;\n  padding: 20px;\n  border: 2px solid #e2e8f0;\n  border-radius: 12px;\n  transition: border-color 0.2s ease;\n}\n\n.image-card:hover {\n  border-color: #cbd5e0;\n}\n\n.image-preview {\n  flex-shrink: 0;\n  width: 120px;\n  height: 120px;\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.image-preview img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.image-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.view-mode h3 {\n  margin: 0 0 8px 0;\n  font-size: 1.1rem;\n  color: #1a202c;\n}\n\n.description {\n  color: #4a5568;\n  margin: 0 0 8px 0;\n  font-size: 0.95rem;\n}\n\n.metadata {\n  color: #a0aec0;\n  font-size: 0.85rem;\n  margin: 0 0 16px 0;\n}\n\n.actions {\n  display: flex;\n  gap: 12px;\n}\n\n.edit-button,\n.delete-button,\n.save-button,\n.cancel-button {\n  padding: 8px 16px;\n  border: none;\n  border-radius: 6px;\n  font-size: 0.9rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.edit-button {\n  background: #edf2f7;\n  color: #2d3748;\n}\n\n.edit-button:hover {\n  background: #e2e8f0;\n}\n\n.delete-button {\n  background: #fed7d7;\n  color: #c53030;\n}\n\n.delete-button:hover {\n  background: #fc8181;\n  color: white;\n}\n\n.save-button {\n  background: #48bb78;\n  color: white;\n}\n\n.save-button:hover {\n  background: #38a169;\n}\n\n.cancel-button {\n  background: #e2e8f0;\n  color: #2d3748;\n}\n\n.cancel-button:hover {\n  background: #cbd5e0;\n}\n\n/**\n * MODE √âDITION\n */\n.edit-mode {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.edit-input {\n  padding: 10px 12px;\n  border: 2px solid #e2e8f0;\n  border-radius: 6px;\n  font-size: 0.95rem;\n}\n\n.edit-input.small {\n  width: 100px;\n}\n\n.edit-actions {\n  display: flex;\n  gap: 12px;\n}\n\n.empty {\n  text-align: center;\n  padding: 40px 20px;\n  color: #718096;\n}\n\n/**\n * RESPONSIVE\n */\n@media (max-width: 768px) {\n  .admin-content {\n    padding: 24px 16px;\n  }\n\n  .card {\n    padding: 24px 20px;\n  }\n\n  .image-card {\n    flex-direction: column;\n  }\n\n  .image-preview {\n    width: 100%;\n    height: 200px;\n  }\n\n  .actions {\n    flex-wrap: wrap;\n  }\n\n  .edit-button,\n  .delete-button {\n    flex: 1;\n    min-width: 120px;\n  }\n}\n</style>\n"],"version":3}